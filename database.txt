# CREACIÓ DE LA BASE DE DADES

CREATE DATABASE pelistube;

USE pelistube;

CREATE TABLE Tarifa(
	nomTarifa varchar(15) PRIMARY KEY,
	preu integer NOT NULL,
	periodicitat varchar(15) NOT NULL,
	estatTarifa boolean
);

CREATE TABLE Categoria(
	nomCat varchar(20) PRIMARY KEY
);

CREATE TABLE Tipus(
IdTipus integer AUTO_INCREMENT PRIMARY KEY,
	edat varchar(15) NOT NULL # he canviat això perque amb un integer no podem posar <9, 9-18 i >18
	
);

CREATE TABLE Contingut(
IdContingut integer AUTO_INCREMENT PRIMARY KEY,
	titol varchar(20) NOT NULL,
	URL varchar(250) NOT NULL,
	nomCat varchar(20),
	FOREIGN KEY (nomCat) REFERENCES Categoria(nomCat)
);

CREATE TABLE R_Tipus_Contingut(
	IdTipus integer,
	IdContingut integer,
	FOREIGN KEY (IdTipus) REFERENCES Tipus(IdTipus),
	FOREIGN KEY (IdContingut) REFERENCES Contingut(IdContingut),
	PRIMARY KEY (IdTipus,IdContingut)
);

CREATE TABLE Persona(
	dataAlta DATE NOT NULL,
	username varchar(15)PRIMARY KEY,
	password varchar(45) NOT NULL,
	nom varchar(25) NOT NULL,
	llinatge1 varchar(20) NOT NULL,
	llinatge2 varchar(20) NOT NULL,
	dataNaixement DATE NOT NULL, # he afegit això perquè al frontend ja ho havia inclòs
	administrador boolean,
	IdTipus integer,
	FOREIGN KEY (IdTipus) REFERENCES Tipus(IdTipus)
);

CREATE TABLE Contracte(
	dataAlta DATE,
	dataBaixa DATE,
	estat boolean,
	IdContracte integer AUTO_INCREMENT PRIMARY KEY,
	nomTarifa varchar(15),
	username varchar(15),
	FOREIGN KEY (nomTarifa) REFERENCES Tarifa(nomTarifa),
FOREIGN KEY (username) REFERENCES Persona(username)	
);

CREATE TABLE Factura(
	import integer NOT NULL,
	dataPagament DATE,
	IdFactura integer AUTO_INCREMENT PRIMARY KEY,
	IdContracte integer,
	FOREIGN KEY (IdContracte) REFERENCES Contracte(IdContracte)
);


CREATE TABLE Missatge(
	descripcio varchar(50),
	estatMissatge boolean,
	IdMissatge integer AUTO_INCREMENT PRIMARY KEY,
	username varchar(15),
	IdContingut integer,
	FOREIGN KEY (username) REFERENCES Persona(username),
	FOREIGN KEY (IdContingut) REFERENCES Contingut(IdContingut)
);

CREATE TABLE ContingutFavorits(
	IdContracte integer,
	IdContingut integer,
	FOREIGN KEY (IdContracte) REFERENCES Contracte(IdContracte),
	FOREIGN KEY (IdContingut) REFERENCES Contingut(IdContingut),
	PRIMARY KEY (IdContracte,IdContingut)
);

CREATE TABLE CategoriaFavorits(
	IdContracte integer,
	nomCat varchar(20),
	FOREIGN KEY (IdContracte) REFERENCES Contracte(IdContracte),
	FOREIGN KEY (nomCat) REFERENCES Categoria(nomCat),
	PRIMARY KEY (IdContracte,nomCat)
);

# ALGUNS INSERTS NECESSARIS

INSERT INTO tipus(edat) VALUES ("<9 anys"),  ("9-18 anys"),  ("+18 anys");

INSERT INTO categoria(nomCat) VALUES ("TERROR"), ("COMÈDIA"), ("INTRIGA");

INSERT INTO persona(dataAlta, username, password, nom, llinatge1, llinatge2, dataNaixement, administrador, IdTipus) values ('0000-00-00','admin', '$1$ciJ2Am3s$jy1CJ0uIm7q9CwmFw.hvS/', 'admin', 'admin', 'admin', '0000-00-00', true, NULL); # CREACIÓ D’UN USUARI ADMINISTRADOR AMB PASSWORD= 1234